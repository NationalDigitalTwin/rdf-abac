


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ABAC</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">io.telicent.jena.abac</a>
</div>

<h1>Coverage Summary for Class: ABAC (io.telicent.jena.abac)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ABAC</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    63.6%
  </span>
  <span class="absValue">
    (7/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    30%
  </span>
  <span class="absValue">
    (3/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    59.4%
  </span>
  <span class="absValue">
    (19/32)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; *  Copyright (c) Telicent Ltd.
&nbsp; *
&nbsp; *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; *  you may not use this file except in compliance with the License.
&nbsp; *  You may obtain a copy of the License at
&nbsp; *
&nbsp; *      http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; *  Unless required by applicable law or agreed to in writing, software
&nbsp; *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; *  See the License for the specific language governing permissions and
&nbsp; *  limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package io.telicent.jena.abac;
&nbsp;
&nbsp;import java.io.InputStream;
&nbsp;import java.util.Set;
&nbsp;
&nbsp;import io.telicent.jena.abac.assembler.SecuredDatasetAssembler;
&nbsp;import io.telicent.jena.abac.core.*;
&nbsp;import io.telicent.jena.abac.labels.Labels;
&nbsp;import io.telicent.jena.abac.labels.LabelsGetter;
&nbsp;import io.telicent.jena.abac.labels.LabelsStore;
&nbsp;import io.telicent.jena.abac.labels.LabelsStoreZero;
&nbsp;import org.apache.jena.graph.Graph;
&nbsp;import org.apache.jena.riot.Lang;
&nbsp;import org.apache.jena.riot.RDFParser;
&nbsp;import org.apache.jena.shacl.ShaclValidator;
&nbsp;import org.apache.jena.shacl.Shapes;
&nbsp;import org.apache.jena.sparql.core.DatasetGraph;
&nbsp;import org.apache.jena.sparql.core.DatasetGraphFilteredView;
&nbsp;import org.apache.jena.sparql.graph.GraphFactory;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;/**
&nbsp; * Programmatic API to the Attribute-Based Access Control functionality.
&nbsp; *
&nbsp; * @see SecuredDatasetAssembler
&nbsp; */
<b class="nc">&nbsp;public class ABAC {</b>
&nbsp;
<b class="fc">&nbsp;    public final static Logger AzLOG = LoggerFactory.getLogger(&quot;io.telicent.jena.abac.Authz&quot;);</b>
<b class="fc">&nbsp;    public final static Logger AttrLOG = LoggerFactory.getLogger(&quot;io.telicent.jena.abac.Attribute&quot;);</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Operate with old style attributes only.
&nbsp;     * This applies to labels, attribute store description, and remote attribute store.
&nbsp;     * No value, no quotes, any character set - no white space or =
&nbsp;     */
<b class="fc">&nbsp;    public static boolean LEGACY = true;</b>
&nbsp;
&nbsp;    /** Per request label evaluation cache size. */
&nbsp;    public static final int labelEvalCacheSize = 100_000;
&nbsp;
&nbsp;    /**
&nbsp;     * Per request hierarchy retrieval cache size.
&nbsp;     * This could become a global cache. The answers are not request sensitive.
&nbsp;     */
&nbsp;    public static final int hierarchyCacheSize = 100;
&nbsp;
&nbsp;    /**
&nbsp;     * Test whether a dataset supports ABAC data labelling.
&nbsp;     */
&nbsp;    public static boolean isDatasetABAC(DatasetGraph dsg) {
<b class="nc">&nbsp;        return dsg instanceof DatasetGraphABAC;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Create a {@link DatasetGraphABAC}.
&nbsp;     */
&nbsp;    public static DatasetGraphABAC authzDataset(DatasetGraph dsgBase, LabelsStore labels, String datasetDefaultLabel, AttributesStore attributesStore) {
<b class="nc">&nbsp;        return authzDataset(dsgBase, null, labels, datasetDefaultLabel, attributesStore);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Create a {@link DatasetGraphABAC}.
&nbsp;     */
&nbsp;    public static DatasetGraphABAC authzDataset(DatasetGraph dsgBase, String accessAttributes,
&nbsp;                                                LabelsStore labels, String datasetDefaultLabel,
&nbsp;                                                AttributesStore attributesStore) {
<b class="fc">&nbsp;        return new DatasetGraphABAC(dsgBase, accessAttributes, labels, datasetDefaultLabel, attributesStore);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Build an attribute-enforcing DatasetGraph. For programmatic/API use,
&nbsp;     * and in unit tests.
&nbsp;     * &lt;p&gt;
&nbsp;     * This is not used by Fuseki.
&nbsp;     */
&nbsp;    public static DatasetGraph requestDataset(DatasetGraphABAC dsgAuthz, AttributeValueSet attributes, HierarchyGetter function) {
<b class="fc">&nbsp;        CxtABAC cxt = CxtABAC.context(attributes, function, dsgAuthz.getData());</b>
<b class="fc">&nbsp;        DatasetGraph dsg = filterDataset(dsgAuthz, cxt);</b>
<b class="fc">&nbsp;        return dsg;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Build an attribute-enforcing DatasetGraph. For programmatic/API use,
&nbsp;     * and in unit tests.
&nbsp;     * &lt;p&gt;
&nbsp;     * This is not used by Fuseki.
&nbsp;     */
&nbsp;    public static DatasetGraph requestDataset(DatasetGraphABAC dsgAuthz, AttributeValueSet attributes, AttributesStore attrStore) {
<b class="nc">&nbsp;        CxtABAC cxt = CxtABAC.context(attributes, attrStore, dsgAuthz.getData());</b>
<b class="nc">&nbsp;        DatasetGraph dsg = filterDataset(dsgAuthz, cxt);</b>
<b class="nc">&nbsp;        return dsg;</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Create an attribute-filtered dataset for a context.
&nbsp;     *
&nbsp;     * @see #requestDataset
&nbsp;     */
&nbsp;    public static DatasetGraph filterDataset(DatasetGraphABAC dsgAuthz, CxtABAC cxt) {
<b class="fc">&nbsp;        return filterDataset(dsgAuthz.getData(), dsgAuthz.labelsStore(), dsgAuthz.getDefaultLabel(), cxt);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Create an attribute-filtered dataset for a context.
&nbsp;     * &lt;p&gt;
&nbsp;     * &quot;No label store&quot; (null) is not the same as an empty label store
&nbsp;     * ({@link LabelsStoreZero}). &quot;No store&quot; mean the label filter isn&#39;t even
&nbsp;     * incorporated into decisions whereas an empty store may have a default.
&nbsp;     * &lt;p&gt;The DatasetGraph is the data storage dataset.
&nbsp;     */
&nbsp;    public static DatasetGraph filterDataset(DatasetGraph dsgBase, LabelsStore labels, String defaultLabel, CxtABAC cxt) {
<b class="fc">&nbsp;        QuadFilter filter = null;</b>
<b class="pc">&nbsp;        if ( labels != null ) {</b>
<b class="fc">&nbsp;            LabelsGetter getter = labels::labelsForTriples;</b>
<b class="fc">&nbsp;            filter = combineFilter(filter, Labels.securityFilterByLabel(dsgBase, getter, defaultLabel, cxt));</b>
&nbsp;        }
<b class="fc">&nbsp;        DatasetGraph dsg = new DatasetGraphFilteredView(dsgBase, filter, Set.of());</b>
<b class="fc">&nbsp;        return dsg;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static QuadFilter combineFilter(QuadFilter filter1, QuadFilter filter2) {
<b class="pc">&nbsp;        if ( filter1 == null )</b>
<b class="fc">&nbsp;            return filter2;</b>
<b class="nc">&nbsp;        if ( filter2 == null )</b>
<b class="nc">&nbsp;            return filter1;</b>
<b class="nc">&nbsp;        return q -&gt; filter1.test(q) &amp;&amp; filter2.test(q);</b>
&nbsp;    }
&nbsp;
&nbsp;    /** Read SHACL from a classpath resource. */
&nbsp;    public static Shapes readSHACL(String resource) {
<b class="fc">&nbsp;        InputStream in  = ABAC.class.getClassLoader().getResourceAsStream(resource);</b>
<b class="pc">&nbsp;        if ( in == null )</b>
<b class="fc">&nbsp;            return null;</b>
<b class="nc">&nbsp;        Graph gShacl = GraphFactory.createDefaultGraph();</b>
<b class="nc">&nbsp;        RDFParser.source(in).lang(Lang.SHACLC).parse(gShacl);</b>
<b class="nc">&nbsp;        Shapes shapes = ShaclValidator.get().parse(gShacl);</b>
<b class="nc">&nbsp;        return shapes;</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-11-26 08:49</div>
</div>
</body>
</html>
