


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > DatasetGraphABAC</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">io.telicent.jena.abac.core</a>
</div>

<h1>Coverage Summary for Class: DatasetGraphABAC (io.telicent.jena.abac.core)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DatasetGraphABAC</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (1/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    68.2%
  </span>
  <span class="absValue">
    (15/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    50%
  </span>
  <span class="absValue">
    (3/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    65.2%
  </span>
  <span class="absValue">
    (30/46)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; *  Copyright (c) Telicent Ltd.
&nbsp; *
&nbsp; *  Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; *  you may not use this file except in compliance with the License.
&nbsp; *  You may obtain a copy of the License at
&nbsp; *
&nbsp; *      http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; *  Unless required by applicable law or agreed to in writing, software
&nbsp; *  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; *  See the License for the specific language governing permissions and
&nbsp; *  limitations under the License.
&nbsp; */
&nbsp;
&nbsp;package io.telicent.jena.abac.core;
&nbsp;
&nbsp;import io.telicent.jena.abac.ABAC;
&nbsp;import io.telicent.jena.abac.AE;
&nbsp;import io.telicent.jena.abac.attributes.AttributeExpr;
&nbsp;import io.telicent.jena.abac.labels.LabelsStore;
&nbsp;import io.telicent.jena.abac.labels.LabelsStoreRocksDB;
&nbsp;import org.apache.jena.query.ReadWrite;
&nbsp;import org.apache.jena.query.TxnType;
&nbsp;import org.apache.jena.sparql.core.DatasetGraph;
&nbsp;import org.apache.jena.sparql.core.DatasetGraphWrapper;
&nbsp;import org.apache.jena.sparql.core.Transactional;
&nbsp;
&nbsp;public class DatasetGraphABAC extends DatasetGraphWrapper {
&nbsp;    // Attribute expression used to determine whether access is allowed.
&nbsp;    // Failing this test, the request is returns with 403 (Forbidden)
&nbsp;    // This may be null, meaning &quot;no test applied&quot;.
&nbsp;    private final String accessAttributesStr;
&nbsp;    private final AttributeExpr accessAttributesExpr;
&nbsp;    private final LabelsStore labelsStore;
&nbsp;    // Default for when the labels store has no labels for a triple.
&nbsp;    // Can be null for system-wide policy (which is deny).
&nbsp;    private final String defaultLabel;
&nbsp;    private final AttributesStore attributesStore;
&nbsp;
&nbsp;    /** API: use {@link ABAC#authzDataset} */
&nbsp;    public DatasetGraphABAC(DatasetGraph base, String accessAttributes,
&nbsp;                            LabelsStore labelsStore, String datasetDefaultLabel,
&nbsp;                            AttributesStore attributesStore) {
<b class="fc">&nbsp;        super(base);</b>
<b class="fc">&nbsp;        this.accessAttributesStr = accessAttributes;</b>
<b class="fc">&nbsp;        this.accessAttributesExpr = AE.parseExpr(accessAttributesStr);</b>
<b class="fc">&nbsp;        this.labelsStore = labelsStore;</b>
<b class="fc">&nbsp;        this.defaultLabel = datasetDefaultLabel;</b>
<b class="fc">&nbsp;        this.attributesStore = attributesStore;</b>
&nbsp;    }
&nbsp;
&nbsp;    /** Get {@link DatasetGraph} being protected */
&nbsp;    public DatasetGraph getData() {
&nbsp;        // Note: DatasetGraphWrapper
&nbsp;        // getBase - recursively unwraps DSG wrapper
&nbsp;        // getWrapped - undoes one level of wrapping and it is the same as protected get().
&nbsp;        // Give the operation a meaningful name for DatasetGraphABAC
<b class="fc">&nbsp;        return get();</b>
&nbsp;    }
&nbsp;
&nbsp;    public AttributeExpr getAccessAttributes() {
<b class="nc">&nbsp;        return accessAttributesExpr;</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getDefaultLabel() {
<b class="fc">&nbsp;        return defaultLabel;</b>
&nbsp;    }
&nbsp;
&nbsp;    public LabelsStore labelsStore() {
<b class="fc">&nbsp;        return labelsStore;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void close() {
<b class="fc">&nbsp;        super.close();</b>
<b class="fc">&nbsp;        if ( labelsStore instanceof LabelsStoreRocksDB x ) {</b>
&nbsp;            try {
<b class="fc">&nbsp;                x.close();</b>
<b class="nc">&nbsp;            } catch (Exception e) {</b>
<b class="nc">&nbsp;                e.printStackTrace();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /** Return the attribute store for this dataset. */
&nbsp;    public AttributesStore attributesStore() {
<b class="fc">&nbsp;        return attributesStore ;</b>
&nbsp;    }
&nbsp;
&nbsp;    /** Return the function for getting the user&#39;s attributes for this dataset. */
&nbsp;    public AttributesForUser attributesForUser() {
<b class="fc">&nbsp;        return attributesStore::attributes ;</b>
&nbsp;    }
&nbsp;
&nbsp;    // Propagate transactions to the labels store.
&nbsp;
<b class="fc">&nbsp;    private Transactional getOther() { return labelsStore.getTransactional(); }</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public void begin() {
<b class="nc">&nbsp;        getOther().begin();</b>
<b class="nc">&nbsp;        super.begin();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public ReadWrite transactionMode() {
<b class="nc">&nbsp;        getOther().transactionMode();</b>
<b class="nc">&nbsp;        return super.transactionMode();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public TxnType transactionType() {
<b class="fc">&nbsp;        getOther().transactionType();</b>
<b class="fc">&nbsp;        return super.transactionType();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void begin(TxnType type) {
&nbsp;        // Do begin, then call the other so that &quot;other&quot; is inside the transaction.
<b class="fc">&nbsp;        super.begin(type);</b>
<b class="fc">&nbsp;        getOther().begin(type);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void begin(ReadWrite readWrite) {
<b class="nc">&nbsp;        super.begin(readWrite);</b>
<b class="nc">&nbsp;        getOther().begin(readWrite);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean promote() {
<b class="fc">&nbsp;        boolean b = super.promote();</b>
<b class="pc">&nbsp;        if ( b )</b>
<b class="fc">&nbsp;            getOther().promote();</b>
<b class="fc">&nbsp;        return b;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean promote(Promote type) {
<b class="nc">&nbsp;        boolean b = super.promote(type);</b>
<b class="nc">&nbsp;        if ( b )</b>
<b class="nc">&nbsp;            getOther().promote(type);</b>
<b class="nc">&nbsp;        return b;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void commit() {
<b class="fc">&nbsp;        getOther().commit();</b>
<b class="fc">&nbsp;        super.commit();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void abort() {
<b class="nc">&nbsp;        getOther().abort();</b>
<b class="nc">&nbsp;        super.abort();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void end() {
<b class="fc">&nbsp;        getOther().end();</b>
<b class="fc">&nbsp;        super.end();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean isInTransaction() {
<b class="fc">&nbsp;        getOther().isInTransaction();</b>
<b class="fc">&nbsp;        return super.isInTransaction();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean supportsTransactions() {
&nbsp;        // DatasetGraph operation.
&nbsp;        //getOther().supportsTransactions();
<b class="fc">&nbsp;        return super.supportsTransactions();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean supportsTransactionAbort() {
&nbsp;        // DatasetGraph operation.
&nbsp;        //getOther().supportsTransactionAort();
<b class="nc">&nbsp;        return super.supportsTransactionAbort();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-11-26 08:49</div>
</div>
</body>
</html>
